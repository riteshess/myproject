package mmcashpo.model.module;

import java.sql.CallableStatement;
import java.sql.SQLException;
import java.sql.Types;
import oracle.jbo.domain.Number;
import mmcashpo.model.module.common.MmCashPOAM;
import mmcashpo.model.views.MmCpoItmVOImpl;

import mmcashpo.model.views.MmCpoTrVOImpl;
import mmcashpo.model.views.MmCpoVOImpl;

import oracle.jbo.JboException;
import oracle.jbo.Row;
import oracle.jbo.ViewObject;
import oracle.jbo.server.ApplicationModuleImpl;
import oracle.jbo.server.ViewLinkImpl;
import oracle.jbo.server.ViewObjectImpl;
// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Wed Dec 12 16:50:55 IST 2012
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class MmCashPOAMImpl extends ApplicationModuleImpl implements MmCashPOAM {
    /**
     * This is the default constructor (do not remove).
     */
    public MmCashPOAMImpl() {
    }

    /**
     * Container's getter for LovItmId1.
     * @return LovItmId1
     */
    public ViewObjectImpl getLovItmId1() {
        return (ViewObjectImpl)findViewObject("LovItmId1");
    }

    /**
     * Container's getter for CpoSearch1.
     * @return CpoSearch1
     */
    public ViewObjectImpl getCpoSearch1() {
        return (ViewObjectImpl)findViewObject("CpoSearch1");
    }


    /**
     * Container's getter for MmCpo1.
     * @return MmCpo1
     */
    public ViewObjectImpl getMmCpo1() {
        return (ViewObjectImpl)findViewObject("MmCpo1");
    }

    /**
     * Container's getter for MmCpoItm1.
     * @return MmCpoItm1
     */
    public MmCpoItmVOImpl getMmCpoItm1() {
        return (MmCpoItmVOImpl)findViewObject("MmCpoItm1");
    }

    /**
     * Container's getter for CpoToCpoItemVL1.
     * @return CpoToCpoItemVL1
     */
    public ViewLinkImpl getCpoToCpoItemVL1() {
        return (ViewLinkImpl)findViewLink("CpoToCpoItemVL1");
    }

    /**
     * Container's getter for LovItmIdForadd1.
     * @return LovItmIdForadd1
     */
    public ViewObjectImpl getLovItmIdForadd1() {
        return (ViewObjectImpl)findViewObject("LovItmIdForadd1");
    }
    
  /*   public String filteration(){
        
        return null;
    } */
    
    public void searchQuery(Integer SlocId,String OrgId,String DocId , String CldId){
          ViewObject v1= this.getMmCpo1();
          v1.setWhereClause("SLOC_ID="+SlocId+" AND ORG_ID='"+OrgId+"' AND DOC_ID='"+DocId+"' AND CLD_ID = '"+CldId+"'");
          v1.executeQuery();
      
      }
    
    public void resetQuery(){
          ViewObject v1= this.getMmCpo1();
          v1.setWhereClause(null);
          v1.executeQuery();
      
      }

    /**
     * Container's getter for MmCpoOc1.
     * @return MmCpoOc1
     */
    public ViewObjectImpl getMmCpoOc1() {
        return (ViewObjectImpl)findViewObject("MmCpoOc1");
    }

    /**
     * Container's getter for MmCpoOc2.
     * @return MmCpoOc2
     */
    public ViewObjectImpl getMmCpoOc2() {
        return (ViewObjectImpl)findViewObject("MmCpoOc2");
    }

    /**
     * Container's getter for CpoToCpoOcVL1.
     * @return CpoToCpoOcVL1
     */
    public ViewLinkImpl getCpoToCpoOcVL1() {
        return (ViewLinkImpl)findViewLink("CpoToCpoOcVL1");
    }

    /**
     * Container's getter for MmCpoTrLines1.
     * @return MmCpoTrLines1
     */
    public ViewObjectImpl getMmCpoTrLines1() {
        return (ViewObjectImpl)findViewObject("MmCpoTrLines1");
    }

    /**
     * Container's getter for MmCpoTr1.
     * @return MmCpoTr1
     */
    public ViewObjectImpl getMmCpoTr1() {
        return (ViewObjectImpl)findViewObject("MmCpoTr1");
    }


    /**
     * Container's getter for PoOrdVw1.
     * @return PoOrdVw1
     */
    public ViewObjectImpl getPoOrdVw1() {
        return (ViewObjectImpl)findViewObject("PoOrdVw1");
    }

    /**
     * Container's getter for CpoItmToPoOrdVwVL1.
     * @return CpoItmToPoOrdVwVL1
     */
    public ViewLinkImpl getCpoItmToPoOrdVwVL1() {
        return (ViewLinkImpl)findViewLink("CpoItmToPoOrdVwVL1");
    }

    /**
     * Container's getter for ItmLovSearch1.
     * @return ItmLovSearch1
     */
    public ViewObjectImpl getItmLovSearch1() {
        return (ViewObjectImpl)findViewObject("ItmLovSearch1");
    }

    /**
     * Container's getter for LovUomId.
     * @return LovUomId
     */
    public ViewObjectImpl getLovUomId() {
        return (ViewObjectImpl)findViewObject("LovUomId");
    }

    /**
     * Container's getter for MmCpoTr2.
     * @return MmCpoTr2
     */
    public MmCpoTrVOImpl getMmCpoTr2() {
        return (MmCpoTrVOImpl)findViewObject("MmCpoTr2");
    }

    /**
     * Container's getter for CpoItmToCpoTrVL1.
     * @return CpoItmToCpoTrVL1
     */
    public ViewLinkImpl getCpoItmToCpoTrVL1() {
        return (ViewLinkImpl)findViewLink("CpoItmToCpoTrVL1");
    }

    /**
     * Container's getter for MmCpoTrLines2.
     * @return MmCpoTrLines2
     */
    public ViewObjectImpl getMmCpoTrLines2() {
        return (ViewObjectImpl)findViewObject("MmCpoTrLines2");
    }

    /**
     * Container's getter for CpoTrToCpoTrLinesVL1.
     * @return CpoTrToCpoTrLinesVL1
     */
    public ViewLinkImpl getCpoTrToCpoTrLinesVL1() {
        return (ViewLinkImpl)findViewLink("CpoTrToCpoTrLinesVL1");
    }

    /**
     * Container's getter for MmCpoTr.
     * @return MmCpoTr
     */
    public MmCpoTrVOImpl getMmCpoTr() {
        return (MmCpoTrVOImpl)findViewObject("MmCpoTr");
    }

    /**
     * Container's getter for MmCpoToMmCpoTrVL1.
     * @return MmCpoToMmCpoTrVL1
     */
    public ViewLinkImpl getMmCpoToMmCpoTrVL1() {
        return (ViewLinkImpl)findViewLink("MmCpoToMmCpoTrVL1");
    }

    /**
     * Container's getter for MmCpoTrLines.
     * @return MmCpoTrLines
     */
    public ViewObjectImpl getMmCpoTrLines() {
        return (ViewObjectImpl)findViewObject("MmCpoTrLines");
    }

    /**
     * Container's getter for CpoTrToCpoTrLinesVL2.
     * @return CpoTrToCpoTrLinesVL2
     */
    public ViewLinkImpl getCpoTrToCpoTrLinesVL2() {
        return (ViewLinkImpl)findViewLink("CpoTrToCpoTrLinesVL2");
    }

    /**
     * Container's getter for LovForCurrConv1.
     * @return LovForCurrConv1
     */
    public ViewObjectImpl getLovForCurrConv1() {
        return (ViewObjectImpl)findViewObject("LovForCurrConv1");
    }
    
    
    
    public Integer pendingUsrCheck(Integer SlocId,String CldId,String OrgId,Integer RcptDocNo){
        Row currRcpt=this.getMmCpo1().getCurrentRow();
        String docIdTxn= currRcpt.getAttribute("DocId").toString();
        System.out.println("DOCIDTXN--"+docIdTxn);
        Integer DOCTYPEID=0;
        Object obj= callStoredFunction(Types.INTEGER, "APP.WF_GET_CUR_USR(?,?,?,?,?,?)", new Object[] { SlocId,CldId,OrgId,RcptDocNo,docIdTxn,DOCTYPEID });
        Integer usrId=null; 
        if(obj!=null){
            usrId=Integer.parseInt(obj.toString());
        }
       System.out.println("User id pending in impl--"+usrId);
        return usrId;
        
    }
    
    public String getWfNo(Integer sloc_id,String cld_id,String org_id,Integer doc_no) {
        Integer DocTypId=0;
        try {
            Object obj=callStoredFunction(Types.VARCHAR, "APP.WF_GET_ID(?,?,?,?,?)",
                                      new Object[] {sloc_id, cld_id, org_id, doc_no,DocTypId });
            System.out.println("WFNO in AMimpl:"+obj.toString());
            return obj.toString();
        } catch (Exception e) {
            System.out.println("GETWFNO--"+e);
            return "0";
        }
    
    }
    
    public Integer getUsrLvl(Integer SlocId,String CldId,String OrgId,Integer usr_id,String WfNum,String rcptDocId){
        Integer DocTypeId=0;
        return Integer.parseInt(callStoredFunction(Types.NUMERIC, "APP.WF_GET_USR_LEVEL(?,?,?,?,?,?,?)", new Object[] { SlocId,CldId,
                                                                                                                                OrgId,
                                                                                                                                usr_id,
                                                                                                                                WfNum,
                                                                                                                                rcptDocId,DocTypeId }).toString());


    }
    
    public Integer insIntoTxn(Integer sloc_id,String cld_id,String pOrgId,Integer rcpt_doc_no,String WfNum,Integer usr_idFrm,Integer usr_idTo,Integer levelTo,Integer levelFrm,String action,String remark,Number amount,String post ){
    System.out.println("Inside method");
        String rcptDocId=this.getMmCpo1().getCurrentRow().getAttribute("DocId").toString();
        Integer DocTypeId=0;
        return Integer.parseInt(callStoredFunction(Types.NUMERIC, "APP.WF_INS_TXN(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)",
                                        new Object[] { sloc_id, cld_id, pOrgId, rcpt_doc_no,DocTypeId, WfNum, rcptDocId,
                                                       usr_idFrm, usr_idTo, levelFrm, levelTo, action, remark,
                                                       amount,post}).toString());
    
    }

    protected Object callStoredFunction(int sqlReturnType, String stmt, Object[] bindVars) {
            CallableStatement st = null;
            try {
                
                st = this.getDBTransaction().createCallableStatement("begin ? := " + stmt + ";end;", 0);
                st.registerOutParameter(1, sqlReturnType);
                if (bindVars != null) {
                    for (int z = 0; z < bindVars.length; z++) {
                        st.setObject(z + 2, bindVars[z]);
                    }
                }
                st.executeUpdate();
     
                return st.getObject(1);
            } catch (SQLException e) {
                throw new JboException(e);
            } finally {
                if (st != null) {
                    try {
                        st.close();
                    } catch (SQLException e) { throw new JboException(e);
                    }
                }
            }
        }
    
    
    public void updateCpoStat()
    {
     this.getMmCpo1().getCurrentRow().setAttribute("AuthStat", "Y"); 
        }

    /**
     * Container's getter for LovUsrIdCreate.
     * @return LovUsrIdCreate
     */
    public ViewObjectImpl getLovUsrIdCreate() {
        return (ViewObjectImpl)findViewObject("LovUsrIdCreate");
    }

    /**
     * Container's getter for OrgMmPrf.
     * @return OrgMmPrf
     */
    public ViewObjectImpl getOrgMmPrf() {
        return (ViewObjectImpl)findViewObject("OrgMmPrf");
    }

    /**
     * Container's getter for MmitmVwVO1.
     * @return MmitmVwVO1
     */
    public ViewObjectImpl getMmitmVwVO1() {
        return (ViewObjectImpl)findViewObject("MmitmVwVO1");
    }
}
