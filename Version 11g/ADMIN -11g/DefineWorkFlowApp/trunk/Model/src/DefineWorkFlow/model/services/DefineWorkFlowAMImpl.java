package DefineWorkFlow.model.services;

import DefineWorkFlow.model.services.common.DefineWorkFlowAM;
import DefineWorkFlow.model.views.AppWfUsrLvlMapVOImpl;


import DefineWorkFlow.model.views.DualVOImpl;

import java.sql.CallableStatement;
import java.sql.SQLException;
import java.sql.Types;

import java.util.Map;

import javax.el.ELContext;
import javax.el.ExpressionFactory;
import javax.el.ValueExpression;

import javax.faces.application.Application;
import javax.faces.context.FacesContext;

import oracle.jbo.JboException;
import oracle.jbo.ViewCriteria;
import oracle.jbo.server.ApplicationModuleImpl;
import oracle.jbo.server.ViewLinkImpl;
import oracle.jbo.server.ViewObjectImpl;

import org.apache.myfaces.trinidad.context.RequestContext;
// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Thu Apr 04 11:22:10 IST 2013
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class DefineWorkFlowAMImpl extends ApplicationModuleImpl implements DefineWorkFlowAM {
    
    private static int VARCHAR = Types.VARCHAR;
       String add_mode = null;
       String edit_mode = null;
       String view_mode = null;
       String del_mode = null;
       
    public String resolvEl1(String data) {
            FacesContext fc = FacesContext.getCurrentInstance();
            Application app = fc.getApplication();
            ExpressionFactory elFactory = app.getExpressionFactory();
            ELContext elContext = fc.getELContext();
            ValueExpression valueExp = elFactory.createValueExpression(elContext, data, Object.class);
            String Message = valueExp.getValue(elContext).toString();
            return Message;
        }
       
       public void applycriteria(){
           String cldid=resolvEl1("#{pageFlowScope.GLBL_APP_CLD_ID}").toString();
           String orgid=resolvEl1("#{pageFlowScope.GLBL_APP_USR_ORG}").toString();
           Integer slocid=Integer.parseInt(resolvEl1("#{pageFlowScope.GLBL_APP_SERV_LOC}").toString());
           System.out.println("cldid "+cldid+" slocid: "+slocid+" orgid: "+orgid);
           ViewObjectImpl vo = this.getAppWf1();
                      ViewCriteria vc = vo.getViewCriteria("AppWfVOCriteria1");
                       vo.applyViewCriteria(vc);
                       vo.setNamedWhereClauseParam("CldIdBind", cldid);
                       vo.setNamedWhereClauseParam("orgIdBind", orgid);
                       vo.setNamedWhereClauseParam("slocIdBind", slocid);
                       vo.executeQuery();
       
       
           ViewObjectImpl docvo = this.getDocMapLovVO1();
                      ViewCriteria vc1 = docvo.getViewCriteria("DocMapLovVOCriteria");
                       docvo.applyViewCriteria(vc1);
                       docvo.setNamedWhereClauseParam("cldIdBind", cldid);
                       docvo.setNamedWhereClauseParam("orgIdBind", orgid);
                       docvo.setNamedWhereClauseParam("slocIdBind", slocid);
                       docvo.executeQuery();
       }
       
    /**
     * This is the default constructor (do not remove).
     */
    public DefineWorkFlowAMImpl() {
    }

    /**
     * Container's getter for AppWf1.
     * @return AppWf1
     */
    public ViewObjectImpl getAppWf1() {
        return (ViewObjectImpl)findViewObject("AppWf1");
    }

    /**
     * Container's getter for AppWfLvl1.
     * @return AppWfLvl1
     */
    public ViewObjectImpl getAppWfLvl1() {
        return (ViewObjectImpl)findViewObject("AppWfLvl1");
    }

    /**
     * Container's getter for WorkFlowToWorkFlowLvlVL1.
     * @return WorkFlowToWorkFlowLvlVL1
     */
    public ViewLinkImpl getWorkFlowToWorkFlowLvlVL1() {
        return (ViewLinkImpl)findViewLink("WorkFlowToWorkFlowLvlVL1");
    }


    /**
     * Container's getter for AppWfDocMap1.
     * @return AppWfDocMap1
     */
    public ViewObjectImpl getAppWfDocMap1() {
        return (ViewObjectImpl)findViewObject("AppWfDocMap1");
    }

    /**
     * Container's getter for AppWfToAppWfDocMapVL1.
     * @return AppWfToAppWfDocMapVL1
     */
    public ViewLinkImpl getAppWfToAppWfDocMapVL1() {
        return (ViewLinkImpl)findViewLink("AppWfToAppWfDocMapVL1");
    }

    /**
     * Container's getter for AppWfUsrLvlMap1.
     * @return AppWfUsrLvlMap1
     */
    public AppWfUsrLvlMapVOImpl getAppWfUsrLvlMap1() {
        return (AppWfUsrLvlMapVOImpl)findViewObject("AppWfUsrLvlMap1");
    }

    /**
     * Container's getter for AppWfDocMapToAppWfUsrLvlMapVL1.
     * @return AppWfDocMapToAppWfUsrLvlMapVL1
     */
    public ViewLinkImpl getAppWfDocMapToAppWfUsrLvlMapVL1() {
        return (ViewLinkImpl)findViewLink("AppWfDocMapToAppWfUsrLvlMapVL1");
    }

    /**
     * Container's getter for AppWfUsrLvlMap2.
     * @return AppWfUsrLvlMap2
     */
    public AppWfUsrLvlMapVOImpl getAppWfUsrLvlMap2() {
        return (AppWfUsrLvlMapVOImpl)findViewObject("AppWfUsrLvlMap2");
    }

    /**
     * Container's getter for AppWfDocMap2.
     * @return AppWfDocMap2
     */
    public ViewObjectImpl getAppWfDocMap2() {
        return (ViewObjectImpl)findViewObject("AppWfDocMap2");
    }

    /**
     * Container's getter for AppWfDocMapValid1.
     * @return AppWfDocMapValid1
     */
    public ViewObjectImpl getAppWfDocMapValid1() {
        return (ViewObjectImpl)findViewObject("AppWfDocMapValid1");
    }

    /**
     * Container's getter for UserLov1.
     * @return UserLov1
     */
    public ViewObjectImpl getUserLov1() {
        return (ViewObjectImpl)findViewObject("UserLov1");
    }

    /**
     * Container's getter for DocMapLovVO1.
     * @return DocMapLovVO1
     */
    public ViewObjectImpl getDocMapLovVO1() {
        return (ViewObjectImpl)findViewObject("DocMapLovVO1");
    }
    
    public String resolvEl(String data) {
           FacesContext fc = FacesContext.getCurrentInstance();
           Application app = fc.getApplication();
           ExpressionFactory elFactory = app.getExpressionFactory();
           ELContext elContext = fc.getELContext();
           ValueExpression valueExp = elFactory.createValueExpression(elContext, data, Object.class);
           String msg = valueExp.getValue(elContext).toString();
           return msg;
       }
    
    
    
       protected Object callStoredFunction(int sqlReturnType, String stmt, Object[] bindVars) {
           CallableStatement st = null;
           try {
               System.out.println("call");
               st = getDBTransaction().createCallableStatement("begin ? := " + stmt + ";end;", 0);
               System.out.println("abbadabbachabba");
               st.registerOutParameter(1, sqlReturnType);
               System.out.println("cacz");
               System.out.println("linght o bind bvararbilerjmh zjf-----?>>>>>"+bindVars.length);
                   
                   try {
               if (bindVars != null) {
                   for (int z = 0; z < bindVars.length; z++) {
                       st.setObject(z + 2, bindVars[z]);
                       System.out.println("insode bindvar");
                   }
                   System.out.println("outside bindvar");
               }
               System.out.println("register");
               st.registerOutParameter(7, VARCHAR);
               st.registerOutParameter(8, VARCHAR);
               st.registerOutParameter(9, VARCHAR);
               st.registerOutParameter(10, VARCHAR);
               
               st.executeUpdate();
              
               
               
                   setAdd_mode(st.getObject(7).toString());
                   setEdit_mode((st.getObject(8).toString()));
                   setView_mode(st.getObject(9).toString());
                   setDel_mode(st.getObject(10).toString());
                   System.out.println(st.getObject(7).toString());
                   System.out.println(st.getObject(8).toString());
                   System.out.println(st.getObject(9).toString());
                   System.out.println(st.getObject(10).toString());
               } catch (NullPointerException e) {
                   System.out.println(e);
                   e.printStackTrace();
               }
               return st.getObject(1);

           } catch (SQLException e) {
               throw new JboException(e);
           } finally {
               if (st != null) {
                   try {
                       st.close();
                   } catch (SQLException e) {
                       System.out.println(e);

                   }
               }
           }
       }
    
    
    
    public Integer on_load_page()
               {  int count = 0;
                  System.out.println("Entery in function");
               String cld_id =  resolvEl("#{pageFlowScope.GLBL_APP_CLD_ID}").toString(); 
               System.out.println("cloud id s----------->>>>>"+cld_id);
               Integer sloc_id = Integer.parseInt(resolvEl("#{pageFlowScope.GLBL_APP_SERV_LOC}").toString()); 
               System.out.println("sloc id s----------->>>>>"+sloc_id);
               String org_id =  resolvEl("#{pageFlowScope.GLBL_APP_USR_ORG}").toString(); 
               System.out.println("org_id is----------->>>>>"+org_id);
               Integer usr_id = Integer.parseInt(resolvEl("#{pageFlowScope.GLBL_APP_USR}").toString()); 
               System.out.println("user id is----------->>>>>"+usr_id);
            System.out.println("calling function");
               callStoredFunction(VARCHAR,"app.fn_get_usr_doc_access_param(?,?,?,?,?,?,?,?,?)",new Object[] { cld_id, sloc_id, org_id, 16,usr_id});
              System.out.println("fns called successfullllllllllyyyyyyyyyyy.....");
               String calledFrom =  resolvEl("#{pageFlowScope.PARAM_PG_CALLED}").toString(); 
               if(add_mode.equalsIgnoreCase("Y") == false && add_mode.equalsIgnoreCase("N") == false)
               {            count = 1;
                   }
               else if(edit_mode.equalsIgnoreCase("Y") == false && edit_mode.equalsIgnoreCase("N") == false)
               {
                   count = 1;
                   }
               else if(view_mode.equalsIgnoreCase("Y") == false && view_mode.equalsIgnoreCase("N") == false)
               {
                  count = 1; 
                   }
               else if (del_mode.equalsIgnoreCase("Y") == false && del_mode.equalsIgnoreCase("N") == false)
               {
                  count = 1; 
                   }
                else if(calledFrom.equalsIgnoreCase("P") == false && calledFrom.equalsIgnoreCase("M") == false)
               {
                  count = 1; 
                   }
               Map paramMap = RequestContext.getCurrentInstance().getPageFlowScope();
               paramMap.put("PARAM_PG_ADD_MD", add_mode); 
               paramMap.put("PARAM_PG_EDIT_MD", edit_mode); 
               paramMap.put("PARAM_PG_VIEW_MD", view_mode); 
               paramMap.put("PARAM_PG_DEL_MD", del_mode); 
               String addMode =  resolvEl("#{pageFlowScope.PARAM_PG_ADD_MD}").toString(); 
                String editMode =  resolvEl("#{pageFlowScope.PARAM_PG_EDIT_MD}").toString(); 
                String viewMode =  resolvEl("#{pageFlowScope.PARAM_PG_VIEW_MD}").toString(); 
                String deleteMode =  resolvEl("#{pageFlowScope.PARAM_PG_DEL_MD}").toString();       
         return count;
           }
    

    public void setAdd_mode(String add_mode) {
        this.add_mode = add_mode;
    }

    public String getAdd_mode() {
        return add_mode;
    }

    public void setEdit_mode(String edit_mode) {
        this.edit_mode = edit_mode;
    }

    public String getEdit_mode() {
        return edit_mode;
    }

    public void setView_mode(String view_mode) {
        this.view_mode = view_mode;
    }

    public String getView_mode() {
        return view_mode;
    }

    public void setDel_mode(String del_mode) {
        this.del_mode = del_mode;
    }

    public String getDel_mode() {
        return del_mode;
    }

    /**
     * Container's getter for DualVO1.
     * @return DualVO1
     */
    public DualVOImpl getDualVO1() {
        return (DualVOImpl)findViewObject("DualVO1");
    }

    /**
     * Container's getter for AppWfVO1.
     * @return AppWfVO1
     */
    public ViewObjectImpl getAppWfVO1() {
        return (ViewObjectImpl)findViewObject("AppWfVO1");
    }
}
