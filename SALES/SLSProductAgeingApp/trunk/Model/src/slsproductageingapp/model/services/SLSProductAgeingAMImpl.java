package slsproductageingapp.model.services;

import javax.el.ELContext;
import javax.el.ExpressionFactory;
import javax.el.ValueExpression;

import javax.faces.application.Application;
import javax.faces.context.FacesContext;

import oracle.jbo.Row;
import oracle.jbo.domain.Timestamp;
import oracle.jbo.server.ApplicationModuleImpl;
import oracle.jbo.server.ViewLinkImpl;


import oracle.jbo.server.ViewObjectImpl;

import slsproductageingapp.model.services.common.SLSProductAgeingAM;
// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Tue Mar 04 15:30:11 IST 2014
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class SLSProductAgeingAMImpl extends ApplicationModuleImpl implements SLSProductAgeingAM {
    /**
     * This is the default constructor (do not remove).
     */
    public SLSProductAgeingAMImpl() {
    }


    /**
     * Method to Get SlocId
     * @return
     */
    public Integer getSlocId(){
       // _log.info("Sloc Id : "+Integer.parseInt(resolvEl("#{pageFlowScope.GLBL_APP_SERV_LOC}")));
        return Integer.parseInt(resolvEl("#{pageFlowScope.GLBL_APP_SERV_LOC}"));
    }
    /**
     * Method to Get OrgId
     * @return
     */
    public String getOrgId(){
        //_log.info("Sloc Id : "+resolvEl("#{pageFlowScope.GLBL_APP_USR_ORG}"));
        return resolvEl("#{pageFlowScope.GLBL_APP_USR_ORG}");
    }
    /**
     * Method to Get HoOrgId
     * @return
     */
    public String getHoOrgId(){
        // _log.info("HoOrg Id : "+resolvEl("#{pageFlowScope.GLBL_HO_ORG_ID}"));
        return resolvEl("#{pageFlowScope.GLBL_HO_ORG_ID}");
    }
    /**
     * Method to Get CldId
     * @return
     */
    public String getCldId(){
        //_log.info("Cld Id : "+resolvEl("#{pageFlowScope.GLBL_APP_CLD_ID}"));
        return resolvEl("#{pageFlowScope.GLBL_APP_CLD_ID}");
    }
    /**
     * Method to Get UsrId
     * @return
     */
    public String getUsrId(){
        //_log.info("Usr Id : "+resolvEl("#{pageFlowScope.GLBL_APP_CLD_ID}"));
        return resolvEl("#{pageFlowScope.GLBL_APP_USR}");
    }
    /**Method to resolve expression- returns String value*/
    public String resolvEl(String data) {
        FacesContext fc = FacesContext.getCurrentInstance();
        Application app = fc.getApplication();
        ExpressionFactory elFactory = app.getExpressionFactory();
        ELContext elContext = fc.getELContext();
        ValueExpression valueExp = elFactory.createValueExpression(elContext, data, Object.class);
        String Message = valueExp.getValue(elContext).toString();
        return Message;
    }
   /**
    * Execute ProductVo on load
    */
    public void executeVos(){
        ViewObjectImpl ageingVO = this.getProductAgeingVO();
        ageingVO.setNamedWhereClauseParam("OrgIdBind", getOrgId());
        ageingVO.executeQuery(); 
        
        ViewObjectImpl ageingT = this.getProductAgeingTimelineVO();
        ageingT.setNamedWhereClauseParam("OrgIdBind", getOrgId());
        ageingT.executeQuery(); 
    }

   public void setAttributesForTempVo(){
       if(this.getProductAgeingVO().getCurrentRow() != null){
            Row currentRow = this.getProductAgeingVO().getCurrentRow();
            //System.out.println("IN"+currentRow.getAttribute("Os30Days")+":"+currentRow.getAttribute("Os60Days"));
            
            Row[] allRowsInRange = this.getTempGraphVo().getAllRowsInRange();
    
            for(Row row :allRowsInRange){
                row.setAttribute("OS30", currentRow.getAttribute("Os30Days"));
                row.setAttribute("OS60", currentRow.getAttribute("Os60Days"));
                row.setAttribute("OS90", currentRow.getAttribute("Os90Days"));
                row.setAttribute("OS120", currentRow.getAttribute("Os120Days"));
                //System.out.println("os30 :"+row.getAttribute("OS30"));
            }
           
            //this.getTempGraphVo().executeQuery();
        }
   }

    /**
     * Container's getter for ProductAgeingVO.
     * @return ProductAgeingVO
     */
    public ViewObjectImpl getProductAgeingVO() {
        return (ViewObjectImpl)findViewObject("ProductAgeingVO");
    }


    /**
     * Container's getter for TempGraphVo.
     * @return TempGraphVo
     */
    public ViewObjectImpl getTempGraphVo() {
        return (ViewObjectImpl)findViewObject("TempGraphVo");
    }

    /**
     * Container's getter for ProductAgeingTimelineVO.
     * @return ProductAgeingTimelineVO
     */
    public ViewObjectImpl getProductAgeingTimelineVO() {
        return (ViewObjectImpl)findViewObject("ProductAgeingTimelineVO");
    }
    
    public void filterProductAgeingVoOnDate(Timestamp fromDt, Timestamp toDt){
        ViewObjectImpl ageingVO = this.getProductAgeingVO();
        ageingVO.setNamedWhereClauseParam("DocDtFrom", fromDt);
        ageingVO.setNamedWhereClauseParam("DocDtTo", toDt);
        ageingVO.executeQuery();
    }
}
