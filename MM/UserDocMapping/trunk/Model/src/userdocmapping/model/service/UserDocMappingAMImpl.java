package userdocmapping.model.service;

import javax.el.ELContext;
import javax.el.ExpressionFactory;
import javax.el.ValueExpression;

import javax.faces.application.Application;
import javax.faces.context.FacesContext;

import oracle.jbo.Row;
import oracle.jbo.server.ApplicationModuleImpl;
import oracle.jbo.server.ViewLinkImpl;
import oracle.jbo.server.ViewObjectImpl;

import userdocmapping.model.service.common.UserDocMappingAM;
import userdocmapping.model.views.AppWfUsrDocMapVOImpl;
// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Thu Jun 05 12:10:54 IST 2014
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class UserDocMappingAMImpl extends ApplicationModuleImpl implements UserDocMappingAM {
    /**
     * This is the default constructor (do not remove).
     */
    public UserDocMappingAMImpl() {
    }

    /**
     * Container's getter for OrgDoc.
     * @return OrgDoc
     */
    public ViewObjectImpl getOrgDoc() {
        return (ViewObjectImpl) findViewObject("OrgDoc");
    }

    /**
     * Container's getter for AppWfUsrDocMap.
     * @return AppWfUsrDocMap
     */
    public AppWfUsrDocMapVOImpl getAppWfUsrDocMap() {
        return (AppWfUsrDocMapVOImpl) findViewObject("AppWfUsrDocMap");
    }

    /**
     * Container's getter for OrgDocToUsrDocMap1.
     * @return OrgDocToUsrDocMap1
     */
    public ViewLinkImpl getOrgDocToUsrDocMap1() {
        return (ViewLinkImpl) findViewLink("OrgDocToUsrDocMap1");
    }

    public void executeCriteriaAtLoad(String cldId, Integer slocId, String orgId) {

        /*   ViewObjectImpl orgDoc = this.getOrgDoc();
        orgDoc.setNamedWhereClauseParam("cldIdBindVar", cldId);
            orgDoc.setNamedWhereClauseParam("slocIdBindVar", slocId);
            orgDoc.setNamedWhereClauseParam("orgIdBindVar", "0r");
            orgDoc.setNamedWhereClauseParam("usrIdBindVar", null);
                orgDoc.setNamedWhereClauseParam("BindDocTypeid", null);
                orgDoc.setNamedWhereClauseParam("docIdbindvar", null);

            orgDoc.executeQuery();
            System.out.println("     "+orgDoc.getQuery());
            System.out.println("     "+orgDoc.getEstimatedRowCount()); */
        this.getOrgDoc().setNamedWhereClauseParam("cldIdBindVar", cldId);
        this.getOrgDoc().setNamedWhereClauseParam("slocIdBindVar", slocId);
        this.getOrgDoc().setNamedWhereClauseParam("orgIdBindVar", orgId);
        this.getOrgDoc().setNamedWhereClauseParam("usrIdBindVar", null);
        this.getOrgDoc().setNamedWhereClauseParam("BindDocTypeid", null);
        this.getOrgDoc().setNamedWhereClauseParam("docIdbindvar", null);

        this.getOrgDoc().executeQuery();

        this.getAppWfUsrDocMap().setNamedWhereClauseParam("cldIdBindVar", cldId);
        this.getAppWfUsrDocMap().setNamedWhereClauseParam("slocIdBindVar", slocId);
        this.getAppWfUsrDocMap().setNamedWhereClauseParam("orgIdBindVar", orgId);
        this.getAppWfUsrDocMap().executeQuery();
        // System.out.println(getOrgDoc().getQuery());
        //System.out.println("    "+getAppWfUsrDocMap().getQuery());
    }

    /**
     * Container's getter for LovUsrId1.
     * @return LovUsrId1
     */
    public ViewObjectImpl getLovUsrId1() {
        return (ViewObjectImpl) findViewObject("LovUsrId1");
    }

    /**
     * Container's getter for LovDocType1.
     * @return LovDocType1
     */
    public ViewObjectImpl getLovDocType1() {
        return (ViewObjectImpl) findViewObject("LovDocType1");
    }

    /**
     * Container's getter for DualSearchVO.
     * @return DualSearchVO
     */
    public ViewObjectImpl getDualSearchVO() {
        return (ViewObjectImpl) findViewObject("DualSearchVO");
    }

    public void SearchMethod() {
        Row curr = getDualSearchVO().getCurrentRow();

        if (curr != null) {
            ViewObjectImpl docVO = getOrgDoc();
            docVO.setNamedWhereClauseParam("orgIdBindVar", curr.getAttribute("TransOrgId"));
            docVO.setNamedWhereClauseParam("slocIdBindVar", curr.getAttribute("TransSlocId"));
            docVO.setNamedWhereClauseParam("cldIdBindVar", curr.getAttribute("TransCldId"));
            docVO.setNamedWhereClauseParam("docIdbindvar", curr.getAttribute("TransDocId"));
            docVO.setNamedWhereClauseParam("usrIdBindVar", curr.getAttribute("TransUsrId"));
            docVO.setNamedWhereClauseParam("BindDocTypeid", curr.getAttribute("TransDocTypeId"));
            docVO.executeQuery();
        }
        getDualSearchVO().executeQuery();
    }

    public void ResetMethod() {
        Row curr = getDualSearchVO().getCurrentRow();

        if (curr != null) {
            ViewObjectImpl docVO = getOrgDoc();
            docVO.setNamedWhereClauseParam("orgIdBindVar", curr.getAttribute("TransOrgId"));
            docVO.setNamedWhereClauseParam("slocIdBindVar", curr.getAttribute("TransSlocId"));
            docVO.setNamedWhereClauseParam("cldIdBindVar", curr.getAttribute("TransCldId"));
            docVO.setNamedWhereClauseParam("docIdbindvar", null);
            docVO.setNamedWhereClauseParam("usrIdBindVar", null);
            docVO.setNamedWhereClauseParam("BindDocTypeid", null);
            docVO.executeQuery();
        }
        getDualSearchVO().executeQuery();
    }

    public String CheckUsrName() {
        if (this.getAppWfUsrDocMap().getCurrentRow().getAttribute("UsrId") != null)
            return "Y";
        else
            return "N";
    }

    public void binVarExecuteforDocType() {
        ViewObjectImpl vw = this.getAppWfUsrDocMap();


        System.out.println("cldIdBindVar" + resolvEl("#{pageFlowScope.GLBL_APP_CLD_ID}").toString());
        vw.setNamedWhereClauseParam("cldIdBindVar", resolvEl("#{pageFlowScope.GLBL_APP_CLD_ID}").toString());
        System.out.println("orgIdBindVar" + resolvEl("#{pageFlowScope.GLBL_APP_USR_ORG}").toString());
        vw.setNamedWhereClauseParam("orgIdBindVar", resolvEl("#{pageFlowScope.GLBL_APP_USR_ORG}").toString());
        System.out.println("slocIdBindVar" +
                           Integer.parseInt(resolvEl("#{pageFlowScope.GLBL_APP_SERV_LOC}").toString()));
        vw.setNamedWhereClauseParam("slocIdBindVar",
                                    Integer.parseInt(resolvEl("#{pageFlowScope.GLBL_APP_SERV_LOC}").toString()));
        System.out.println("doc id variable" + vw.getCurrentRow().getAttribute("DocId").toString());
        vw.setNamedWhereClauseParam("docIdBindVar", vw.getCurrentRow().getAttribute("DocId").toString());
        System.out.println("doc type id " + vw.getCurrentRow().getAttribute("DocTypeID").toString());
        vw.setNamedWhereClauseParam("DocTypeId", vw.getCurrentRow().getAttribute("DocTypeID").toString());

        vw.executeQuery();
    }

    private Object resolvEl(String data) {
        FacesContext fc = FacesContext.getCurrentInstance();
        Application app = fc.getApplication();
        ExpressionFactory elFactory = app.getExpressionFactory();
        ELContext elContext = fc.getELContext();
        ValueExpression valueExp = elFactory.createValueExpression(elContext, data, Object.class);
        // System.out.println("In resolvel="+valueExp.getValue(elContext));
        Object msg = valueExp.getValue(elContext);
        return msg;
    }


}
