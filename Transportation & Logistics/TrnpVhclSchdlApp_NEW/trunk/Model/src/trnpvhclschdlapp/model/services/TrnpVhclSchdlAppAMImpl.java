package trnpvhclschdlapp.model.services;

import adf.utils.ebiz.EbizParams;
import adf.utils.model.ADFModelUtils;

import java.sql.Types;

import oracle.jbo.Row;
import oracle.jbo.domain.Timestamp;
import oracle.jbo.server.ApplicationModuleImpl;
import oracle.jbo.server.ViewObjectImpl;

import trnpvhclschdlapp.model.services.common.TrnpVhclSchdlAppAM;
import trnpvhclschdlapp.model.views.VhclSchdlCalendarVOImpl;
// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Tue Oct 27 18:19:20 IST 2015
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class TrnpVhclSchdlAppAMImpl extends ApplicationModuleImpl implements TrnpVhclSchdlAppAM {

    Integer glblDocId = 24254;

    /**
     * This is the default constructor (do not remove).
     */
    public TrnpVhclSchdlAppAMImpl() {
    }

    /**
     * Container's getter for DualSearchParams1.
     * @return DualSearchParams1
     */
    public ViewObjectImpl getDualSearchParams1() {
        return (ViewObjectImpl) findViewObject("DualSearchParams1");
    }

    /**
     * Container's getter for LoadingRequestVw1.
     * @return LoadingRequestVw1
     */
    public ViewObjectImpl getLoadingRequestVw1() {
        return (ViewObjectImpl) findViewObject("LoadingRequestVw1");
    }

    public void searchRecordsFrmParams(String mode) {
        Row currRow = this.getDualSearchParams1().getCurrentRow();

        if (mode.equals("V") || mode.equals("E")) {
            this.getLoadingRequestVw1().setNamedWhereClauseParam("bookIdBind", currRow.getAttribute("BookIdTrans"));
        } else {
            this.getLoadingRequestVw1().setNamedWhereClauseParam("bookIdBind", null);
        }
        this.getLoadingRequestVw1().setNamedWhereClauseParam("cldIdBind", currRow.getAttribute("CldIdTrans"));
        this.getLoadingRequestVw1().setNamedWhereClauseParam("hoOrgIdBind", currRow.getAttribute("HoOrgIdTrans"));
        this.getLoadingRequestVw1().setNamedWhereClauseParam("jrnyEndDtBind", currRow.getAttribute("JrnyEndDtTrans"));
        this.getLoadingRequestVw1().setNamedWhereClauseParam("jrnyStDtBind", currRow.getAttribute("JrnyStDtTrans"));
        this.getLoadingRequestVw1().setNamedWhereClauseParam("orgIdBind", currRow.getAttribute("OrgIdTrans"));
        this.getLoadingRequestVw1().setNamedWhereClauseParam("ownrSpBind", currRow.getAttribute("OwnrshpTypeTrans"));
        this.getLoadingRequestVw1().setNamedWhereClauseParam("reqEndDtBind", currRow.getAttribute("ReqEndDtTrans"));
        this.getLoadingRequestVw1().setNamedWhereClauseParam("reqStDtBind", currRow.getAttribute("ReqStDtTrans"));
        this.getLoadingRequestVw1().setNamedWhereClauseParam("routeIdBind", currRow.getAttribute("RouteDocIdTrans"));
        this.getLoadingRequestVw1().setNamedWhereClauseParam("slocIdBind", currRow.getAttribute("SlocIdTrans"));
        this.getLoadingRequestVw1().setNamedWhereClauseParam("vhclTypBind", currRow.getAttribute("VhclTypeTrans"));
        this.getLoadingRequestVw1().setNamedWhereClauseParam("modeBind", mode);
        this.getLoadingRequestVw1().executeQuery();

        this.getTrnpVhclPrfVw1().setNamedWhereClauseParam("bookIdBind", currRow.getAttribute("BookIdTrans"));
        this.getTrnpVhclPrfVw1().setNamedWhereClauseParam("cldIdBind", currRow.getAttribute("CldIdTrans"));
        this.getTrnpVhclPrfVw1().setNamedWhereClauseParam("hoOrgIdBind", currRow.getAttribute("HoOrgIdTrans"));
        this.getTrnpVhclPrfVw1().setNamedWhereClauseParam("jrnyEndDtBind", currRow.getAttribute("JrnyEndDtTrans"));
        this.getTrnpVhclPrfVw1().setNamedWhereClauseParam("jrnyStDtBind", currRow.getAttribute("JrnyStDtTrans"));
        this.getTrnpVhclPrfVw1().setNamedWhereClauseParam("orgIdBind", currRow.getAttribute("OrgIdTrans"));
        this.getTrnpVhclPrfVw1().setNamedWhereClauseParam("ownrShipBind", currRow.getAttribute("OwnrshpTypeTrans"));
        this.getTrnpVhclPrfVw1().setNamedWhereClauseParam("reqEndDtBind", currRow.getAttribute("ReqEndDtTrans"));
        this.getTrnpVhclPrfVw1().setNamedWhereClauseParam("reqStDtBind", currRow.getAttribute("ReqStDtTrans"));
        this.getTrnpVhclPrfVw1().setNamedWhereClauseParam("slocIdBind", currRow.getAttribute("SlocIdTrans"));
        this.getTrnpVhclPrfVw1().setNamedWhereClauseParam("vhclCatBind", currRow.getAttribute("VhclCatTrans"));
        this.getTrnpVhclPrfVw1().setNamedWhereClauseParam("vhclTypeBind", currRow.getAttribute("VhclTypeTrans"));
        this.getTrnpVhclPrfVw1().setNamedWhereClauseParam("modeBind", mode);

        this.getTrnpVhclPrfVw1().executeQuery();

        VhclSchdlCalendarVOImpl impl = this.getVhclSchdlCalendar1();
        impl.setcldIdBind((String) currRow.getAttribute("CldIdTrans"));
        impl.setslocIdBind((Integer) currRow.getAttribute("SlocIdTrans"));
        impl.sethoOrgIdBind((String) currRow.getAttribute("HoOrgIdTrans"));
        impl.setorgIdBind((String) currRow.getAttribute("OrgIdTrans"));
        impl.setstrtDtBind((Timestamp) currRow.getAttribute("ReqStDtTrans"));
        impl.setendDtBind((Timestamp) currRow.getAttribute("ReqEndDtTrans"));
        /* this.getVhclSchdlCalendar1().setNamedWhereClauseParam("cldIdBind", currRow.getAttribute("CldIdTrans"));
        this.getVhclSchdlCalendar1().setNamedWhereClauseParam("slocIdBind", currRow.getAttribute("SlocIdTrans"));
        this.getVhclSchdlCalendar1().setNamedWhereClauseParam("hoOrgIdBind", currRow.getAttribute("HoOrgIdTrans"));
        this.getVhclSchdlCalendar1().setNamedWhereClauseParam("orgIdBind", currRow.getAttribute("OrgIdTrans"));
        this.getVhclSchdlCalendar1().setNamedWhereClauseParam("strtDtBind", currRow.getAttribute("ReqStDtTrans"));
        this.getVhclSchdlCalendar1().setNamedWhereClauseParam("endDtBind", currRow.getAttribute("ReqEndDtTrans"));
        this.getVhclSchdlCalendar1().executeQuery(); */
        impl.executeQuery();
        System.out.println("No. of Rows are=" + this.getVhclSchdlCalendar1().getAllRowsInRange().length);
    }

    public void resetRecordsFrmParams() {
        this.getDualSearchParams1().executeQuery();
        this.getLoadingRequestVw1().setNamedWhereClauseParam("cldIdBind", null);
        this.getLoadingRequestVw1().setNamedWhereClauseParam("hoOrgIdBind", null);
        this.getLoadingRequestVw1().setNamedWhereClauseParam("jrnyEndDtBind", null);
        this.getLoadingRequestVw1().setNamedWhereClauseParam("jrnyStDtBind", null);
        this.getLoadingRequestVw1().setNamedWhereClauseParam("orgIdBind", null);
        this.getLoadingRequestVw1().setNamedWhereClauseParam("ownrSpBind", null);
        this.getLoadingRequestVw1().setNamedWhereClauseParam("reqEndDtBind", null);
        this.getLoadingRequestVw1().setNamedWhereClauseParam("reqStDtBind", null);
        this.getLoadingRequestVw1().setNamedWhereClauseParam("routeIdBind", null);
        this.getLoadingRequestVw1().setNamedWhereClauseParam("slocIdBind", null);
        this.getLoadingRequestVw1().setNamedWhereClauseParam("vhclTypBind", null);
        this.getLoadingRequestVw1().setNamedWhereClauseParam("bookIdBind", null);
        this.getLoadingRequestVw1().executeQuery();

        this.getTrnpVhclPrfVw1().setNamedWhereClauseParam("bookIdBind", null);
        this.getTrnpVhclPrfVw1().setNamedWhereClauseParam("cldIdBind", null);
        this.getTrnpVhclPrfVw1().setNamedWhereClauseParam("hoOrgIdBind", null);
        this.getTrnpVhclPrfVw1().setNamedWhereClauseParam("jrnyEndDtBind", null);
        this.getTrnpVhclPrfVw1().setNamedWhereClauseParam("jrnyStDtBind", null);
        this.getTrnpVhclPrfVw1().setNamedWhereClauseParam("orgIdBind", null);
        this.getTrnpVhclPrfVw1().setNamedWhereClauseParam("ownrShipBind", null);
        this.getTrnpVhclPrfVw1().setNamedWhereClauseParam("reqEndDtBind", null);
        this.getTrnpVhclPrfVw1().setNamedWhereClauseParam("reqStDtBind", null);
        this.getTrnpVhclPrfVw1().setNamedWhereClauseParam("slocIdBind", null);
        this.getTrnpVhclPrfVw1().setNamedWhereClauseParam("vhclCatBind", null);
        this.getTrnpVhclPrfVw1().setNamedWhereClauseParam("vhclTypeBind", null);
        this.getTrnpVhclPrfVw1().executeQuery();


    }

    /**
     * Container's getter for DualForCalc1.
     * @return DualForCalc1
     */
    public ViewObjectImpl getDualForCalc1() {
        return (ViewObjectImpl) findViewObject("DualForCalc1");
    }

    /**
     * Container's getter for TrnpVhclPrfVw1.
     * @return TrnpVhclPrfVw1
     */
    public ViewObjectImpl getTrnpVhclPrfVw1() {
        return (ViewObjectImpl) findViewObject("TrnpVhclPrfVw1");
    }

    public void UncheckOtherVehicle() {
        Row[] fr = this.getTrnpVhclPrfVw1().getFilteredRows("TransSelectVhclCB", "true");
        System.out.println("No. of Filtered Rows in AM=" + fr.length);
        if (fr.length > 0)
            fr[0].setAttribute("TransSelectVhclCB", "false");
    }

    public String bookVehicleSchdule(String mode) {
        
        Row frvhclRow[] = this.getTrnpVhclPrfVw1().getFilteredRows("TransSelectVhclCB", "true");
        Row[] lrVo = this.getLoadingRequestVw1().getFilteredRows("TransSelectCB", "true");
        
        String docId = null;
        String dispId = null;
        
        if (frvhclRow.length > 0 && lrVo.length > 0) //if any vehicle is selected then go inside else show msg
        {
            if (mode.equals("E") && this.getDualSearchParams1().getCurrentRow().getAttribute("BookIdTrans") != null) {
                docId = (String) this.getDualSearchParams1().getCurrentRow().getAttribute("BookIdTrans");
                Row frSchdl[] = this.getSlsTrnpVhclSchdl1().getFilteredRows("DocId", docId);
                for (Row hRow : frSchdl) {
                    hRow.setAttribute("VhclNo", frvhclRow[0].getAttribute("FaRegNo"));
                    hRow.setAttribute("VhclItmId", frvhclRow[0].getAttribute("ItmId"));
                    dispId = (String) hRow.getAttribute("SchdlNo");
                }
                Row dtlRw[] = this.getSlsTrnpVhclSchdlDtl1().getFilteredRows("DocId", docId);
                for (Row dRow : dtlRw) {
                    dRow.remove();
                }
            } else {

                Row schdlRw = this.getSlsTrnpVhclSchdl1().createRow();
                schdlRw.setAttribute("VhclNo", frvhclRow[0].getAttribute("FaRegNo"));
                schdlRw.setAttribute("VhclItmId", frvhclRow[0].getAttribute("ItmId"));
                schdlRw.setAttribute("RouteDocId",
                                     this.getDualSearchParams1().getCurrentRow().getAttribute("RouteDocIdTrans"));
                schdlRw.setAttribute("Status", 31);
                this.getSlsTrnpVhclSchdl1().insertRow(schdlRw);
                String schdlNo = null;
                Integer fyid =
                    EbizParams.getFyId(this.getRootApplicationModule(), EbizParams.GLBL_APP_USR_ORG(),
                                       new Timestamp(System.currentTimeMillis()));
                if (fyid != null) {
                    schdlNo =
                        (String) ADFModelUtils.callFunction(this.getRootApplicationModule(),
                                                            new StringBuilder("SLS.TRNP_GEN_DISP_DOC_ID(?,?,?,?,?,?,?,?,?)"), new Object[] {
                                                            EbizParams.GLBL_APP_SERV_LOC(),
                                                            EbizParams.GLBL_APP_CLD_ID(), EbizParams.GLBL_APP_USR_ORG(),
                                                            glblDocId, null, 0, "SLS$TRNP$VHCL$SCHDL", fyid, 0
                    }, Types.VARCHAR);
                }
                dispId = schdlNo;
                this.getSlsTrnpVhclSchdl1().getCurrentRow().setAttribute("SchdlNo", schdlNo);
                docId = (String) this.getSlsTrnpVhclSchdl1().getCurrentRow().getAttribute("DocId");

            }

            Row frReqRow[] = this.getLoadingRequestVw1().getFilteredRows("TransSelectCB", "true");
            for (Row reqRw : frReqRow) {
                Row dtlRw = this.getSlsTrnpVhclSchdlDtl1().createRow();
                dtlRw.setAttribute("DocId", docId);
                dtlRw.setAttribute("LrDocId", reqRw.getAttribute("DocId"));
                dtlRw.setAttribute("LrDt", reqRw.getAttribute("LrDt"));
                dtlRw.setAttribute("LrStrtDt", reqRw.getAttribute("StrtDt"));
                dtlRw.setAttribute("LrEndDt", reqRw.getAttribute("EndDt"));
                this.getSlsTrnpVhclSchdlDtl1().insertRow(dtlRw);
            }


        } else {
            //show msg that please select a vehicle no
            return "NoRowSelected";
        }

        this.getDBTransaction().commit();
        this.getDualSearchParams1().getCurrentRow().setAttribute("BookIdTrans", docId);
        this.getDualSearchParams1().getCurrentRow().setAttribute("BookNoTrans", dispId);
        return dispId;
    }

    /**
     * Container's getter for SlsTrnpVhclSchdl1.
     * @return SlsTrnpVhclSchdl1
     */
    public ViewObjectImpl getSlsTrnpVhclSchdl1() {
        return (ViewObjectImpl) findViewObject("SlsTrnpVhclSchdl1");
    }


    public String genTxnId() {
        return (String) EbizParams.generateDocTxnId(this.getRootApplicationModule(), glblDocId);
    }


    /**
     * Container's getter for SlsTrnpVhclSchdlDtl1.
     * @return SlsTrnpVhclSchdlDtl1
     */
    public ViewObjectImpl getSlsTrnpVhclSchdlDtl1() {
        return (ViewObjectImpl) findViewObject("SlsTrnpVhclSchdlDtl1");
    }

    /**
     * Container's getter for VhclSchdlCalendar1.
     * @return VhclSchdlCalendar1
     */
    public VhclSchdlCalendarVOImpl getVhclSchdlCalendar1() {
        return (VhclSchdlCalendarVOImpl) findViewObject("VhclSchdlCalendar1");
    }

    public void setBindVarInCalendar() {

        //        this.getVhclSchdlCalendar1().setNamedWhereClauseParam("strtDtBind", currRow.getAttribute("ReqStDtTrans"));
        //        this.getVhclSchdlCalendar1().setNamedWhereClauseParam("endDtBind", currRow.getAttribute("ReqEndDtTrans"));
        //        this.getVhclSchdlCalendar1().executeQuery();
    }
}


